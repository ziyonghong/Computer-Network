## 3.运输层

### 3.1运输层服务

运输层两大重要协议TCP / UDP .

运输层协议是在端系统中而不是在路由器中实现的。在发送端，运输层将从发送应用程序进程接收到的报文转换成运输层分组（**报文段**）。 运输层将报文段传递给网络层。

UDP和TCP最基本的责任是将网络层的两个端系统（主机）间IP的交付服务扩展为运行在端系统上的两个进程之间的交付服务。将主机交付扩展到进程间交付被称为 **运输层的多路复用** 与 **多路分解**。

### 3.2多路复用与多路分解

在接收端，运输层检查报文段中的字段，标识出接收套接字，进而将报文段定向到该套接字。将运输层报文段中的数据交付到正确的套接字的工作称 **多路分解**。

在源主机从不同套接字中收集数据块，并为每个数据块封装上首部信息（这将用于分解）从而生成报文段，然后将报文段传递到网络层，这称 **多路复用**。

多路复用要求：1.套接字有唯一标识符；2.每个报文段有特殊字段（**源/目的端口字段**）来指示该报文段所要交付到的套接字。

### 



### 3.3无连接运输：UDP

#### 3.3.1 UDP报文段结构

![](F:\Desktop\Typora\Computer-Network\UDP报文段格式.png)

通过目的端口号可以使目的主机将应用数据交给运行在目的端系统中的相应进程（即执行分解功能），

长度：在UDP报文段中的字节数（首部加数据）

接收方使用检验和检查在该报文段中是否出现了差错。

#### 3.3.2 UDP 校验和

提供差错校验功能，校验和用于确定当UDP报文段从源到达目的地移动时，其中的比特是否发生了改变。虽然它提供差错检测，但它对差错恢复无能为力。

### 3.4可靠数据传输原理

#### 3.4.1 构造可靠数据传输协议

**1.经完全可靠信道的可靠数据传输：rdt 1.0**  [rdt可靠数据传输协议]

rdt 1.0 发送方和接收方的有限状态机（FSM）：

![](F:\Desktop\Typora\Computer-Network\用于完全可靠信道的协议.png)

发送方和接收方有各自的FSM，且FSM每个都只有一个状态。图中的箭头指示了协议从一个状态变迁到另一个状态，引起变迁的事件显示在表示变迁的横线上方，事件发生时所采取的动作显示在横线下方。FSM的初始状态用虚线表示。

**2.经过有比特差错信道的可靠数据传输： rdt 2.0**

自动重传请求（ARQ）协议中还需要另外三种协议功能来处理存在比特差错的情况：

差错检测，一种机制以使接收方检测到何时出现了比特差错。

接收方反馈，发送方要了解接收方情况（此时分组是否被正确接收）的唯一途径就是让接收方提供明确的反馈信息给发送方。

重传，接收方收到有差错的分组时，发送方重传该分组文。

![](F:\Desktop\Typora\Computer-Network\用于具有比特差错信道的协议.png)

rdt 2.0 的FSM，ACK:肯定确认， NAK：否定确认  sndpkt：包含待发送数据的分组

停等协议：当发送方处于等待ACK或NAK的状态时，它不能从上层获得更多的数据 （rdt_send（）事件不可能出现），仅当接收到ACK并离开该状态时才能发生这样的事件。

rdt 2.0 缺陷：没有考虑到ACK或NAK分组受损的可能性



































